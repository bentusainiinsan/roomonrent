
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sonipat Home Service - Rent Properties in Sonipat</title>
    <meta name="description" content="Find and list rooms, shops, houses, factories, and godowns for rent in Sonipat, Kundli, Rai, Murthal, Ganaur, Kharkhoda, Gohana, and Bahalgarh. Your one-stop solution for property rentals.">
    <meta name="keywords" content="rent in sonipat, property on rent, sonipat homes, kundli rent, rai industrial area, murthal property, ganaur rooms, kharkhoda factory, gohana shop rent, bahalgarh godown, sonipat home service">
    <meta name="author" content="Sonipat Home Service">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
import React, { useState, useEffect, useMemo, useRef } from 'react';
import { createRoot } from 'react-dom/client';
// FIX: Removed LiveSession as it is not an exported member of @google/genai.
import { GoogleGenAI, Modality, Blob as GenAIBlob, LiveServerMessage } from "@google/genai";

// =================================================================================
// TYPES
// =================================================================================

const PropertyType = {
  Room: 'Room',
  Shop: 'Shop',
  House: 'House',
  Villa: 'Villa',
  Factory: 'Factory',
  Godown: 'Godown',
};

// =================================================================================
// CONSTANTS
// =================================================================================

const sonipatLocations = {
  "Sonipat": [
    "4 Marla", "8 Marla", "Adersh Nagar", "Anand Nagar", "Arya Nagar", "Ashok Nagar", "Ashok Vihar", "Baba Colony", "Badwasni Gaon", "Bandepur", "Bara Bagad", "Batra Colony", "Bayanpur", "Bhagat Pura", "Bhagat Singh Colony", "Bharam Colony", "Bharam Nagar", "Bharatpuri", "Bhattan Mohalla", "Bheem Nagar", "Chawla Colony", "Chintpurni Colony", "Chitana Gaon", "Chotu Ram Chowk", "Chouhan Colony", "Davru Gaon", "Davru Road", "Defence Colony", "Deha Basti", "Delhi Camp", "Dev Nagar", "Dhanak Basti", "Dhiya Colony", "Double Story", "Faj Bazar", "Faraz Khana", "Ganj Bazar", "Garh Sahajanpur", "Garhi Bharmana", "Garhi Gasita", "Gokul Nagar", "Govind Nagar", "Hanuman Nagar", "Hem Park", "Hullaheri Gaon", "Indian Colony", "Indra Colony", "Indra Colony, Kailash Pur", "Jamalpura", "Janta Colony", "Jatti Kalan", "Jatwara", "Jawahar Nagar", "Jeevan Nagar", "Kaath Mandi", "Kabir Nagar-Kalupur", "Kabir Pur", "Kachhey Querter", "Kailash Colony", "Kakroi Road", "Kalash Colony", "Kalupur", "Katth Mandi", "Khan Colony", "Khari Kwa", "Kot Mohalla", "Krishan Pura", "Krishana Nagar", "Kriti Nagar", "Kumhar Gate", "Lajpat Nagar", "Lal Darwaja", "Lehrara", "Luxmi Nagar", "Mahabir Colony", "Malviya Nagar", "Mamchand Colony", "Maya Puri", "Mc Colony", "Mirch Mandi", "Mission Road", "Model Town", "Mohalla Kalan", "Mohan Nagar", "Mohanpura", "Nandwani Nagar", "Narender Nagar", "New Jeevan Nagar", "Old Housing Board Colony", "Om Colony", "Omnagar", "Other", "Pancham Nagar", "Parbhu Nagar", "Pargati Nagar", "Patel Nagar", "Prem Nagar", "Prem Nagar- Kakroi Road", "Prem Nagar-Behind Bus Stand", "Pwd Colony", "Railway Colony", "Raj Mohalla", "Rajiv Colony", "Rajiv Nagar", "Ram Nagar", "Rishi Colony", "Rk Colony", "Roop Nagar", "Sabun Darwaja", "Sai Baba Colony", "Sainipura", "Sant Garb Dass Nagar", "Sector 1", "Sector 10", "Sector 11", "Sector 12", "Sector 13", "Sector 14", "Sector 15", "Sector 15 Housing Board", "Sector 16", "Sector 17", "Sector 18", "Sector 19", "Sector 23", "Sector 3", "Sector 7", "Sector 9", "Shadipur", "Shanti Vihar", "Shartri Colony", "Shastri Park", "Shiv Colony", "Sidharth Colony", "Sikka Colony", "Sri Nagar", "Sudama Nagar", "Sujjan Singh Park", "Sundal Mohalla", "Sunder Sawari", "Tara Nagar", "Teacher Colony", "Uttam Nagar", "Vikas Nagar", "Vikas Nagar- Murthal Road", "Vishal Nagar", "West Ram Nagar"
  ],
  "Gannaur": [
    "Anup Nagar", "B.S.T Colony", "Baddi", "Badi leharari", "Barodth", "Baye barodth", "Bega", "Bhakadpur", "Bhuri", "Bigaan", "Chirsmi", "chotti leharari", "Deha", "Dhatoli", "Dhutri", "Gandhi Nagar", "Gannaur Mandi", "Garhi gulama", "Garhi Kashri", "Gayaspur", "Ghasoli", "Hari Nagar", "Hasanpur", "Janta School", "K.D.Nagar", "Kami", "Khera Taga", "Kot Mohalla", "Kurad", "Ladsoli", "lala Garhi", "Maichand Colony", "Namaste Chowk", "Papnera", "Pardhanwas Mohalla", "Patti bharaman", "Peer garhi", "Pelanda garhi", "Pipli khera", "Rajpura", "Ramnagar", "Rashulpur", "Rehda Basti", "Roshanpur", "Shashtri Nagar", "Shehpur", "Sunfeda", "Tandoli", "Umedgarh", "Vasant Nagar"
  ],
  "Kharkhoda": [
    "Badhana", "Bahiyanpur", "Barona", "Bidhallan", "Farmana", "Fathepur", "Firozpur Bangar", "Garhi Sisana", "Gopalpur", "Gorad", "Harshana Kalan", "Jagdishpur", "Jatola", "Jhanjoli", "Jharoth", "Jharothi", "Kakroi", "Katlupur", "Khanda", "Kharkhoda", "Kheri Dhaiya", "Khrumpur", "Kundal", "Leharara", "Livaan", "Mandora", "Mandori", "Matindu", "Mohammdabad", "Mojamnagar", "Nakloi", "Naseebpur Bangar", "Nasirpur Choulka", "Nirthaan", "Nithaan", "Nizampur Khurd", "Nizampur Mazra", "Pai", "Parladpur", "Pipli", "Quali", "Rathdhana", "Redhu", "Rohana", "Rohat", "Shedpur", "Sheri", "Shotti", "Silana", "Sinoli", "Sisana", "Thana Kalan", "Thana Khurd", "Trukhpur"
  ],
  "Kailana": [
    "Agawanpur", "Ahulana", "Attal", "Bajana Kalan", "Bajana Khurd", "Balli", "Bhaver", "Bilindpur", "Chatiya", "Gamdaa", "Ghummad", "Heer Mazra", "Jahri", "Jassi Pur", "Kalana", "Kehri", "Khabru", "Mazra", "Naya Bass", "Panchi", "Pugthalla", "Purkash", "Razlu Garhi", "Sandal Kalan", "Sandal Khurd", "Sardaana", "Sazadpur", "Seeya Khera", "Shekpura", "Tavedi", "Tharu"
  ],
  "Rai Bahalgarh": [
    "Aterna", "Bad Malik", "Badkhalsha", "Badoli", "Bahalgarh", "Barota", "Behra ( Bakipur)", "Chauhan Joshi", "Chetera", "Dadhi Nangal", "Dipalpur", "Garh Marikpur", "Garh Sejhenpur", "Jagdishpur", "Jainpur", "Jakholi", "Jat Joshi", "Jathadi", "Jatti Kalan", "Jhundpur", "Kamaspur", "Kheri", "Khewara", "Khurampur", "Kundli", "Liwaspur", "Makimpur", "Malikpur", "Manoli", "Mazra", "Mehandipur", "Mimarpur", "Murthal", "Nandnaur", "Nangal", "Nathupur", "Nehra", "Nehri", "Orangabad", "Palada", "Paladi", "Peou Manhari", "Rai", "Raipur", "Rasoi", "Revali", "Saberpur", "Seveli", "Shahpur", "Tanda", "Tikola"
  ],
  "Gohana": [
    "Abadi rattangarh", "Adarsh Nagar", "Badota", "Badwasni", "Baggad", "Barota", "Bhaadi", "Bhatana", "Bhatgaon dugran", "Bhatgaon dugran garhi haqiqat", "Bhatgaon maalyan", "Bidghal", "Bohelaa", "Chatiya Deva", "Chitana", "Chopra Colony", "citawali", "Dariyapur Basti", "Dodavaa", "Dubeta", "Gamadi", "Gangser", "Garhi Naamdar Khaa", "Garhi Sarai naamdaar kha", "Garhi Ujala khaa", "Gohana City", "Gohana Mandi", "Grina", "Gudaa", "Hasangarh", "Hullaheri", "Jaji", "Jholly", "Jind Road", "Jolly", "Jua", "Kakaana", "Kalana Khash", "Kashandi", "Kasnada", "Keravedi", "Khandrai", "Khanpur kalan", "Kheri", "Kheri damkan", "Khijrpur jaat mazra", "Kilhond", "Lath", "Lath", "Laxmi Nagar", "Luhari Tibba", "Machri", "Mahalana", "Mahipur", "Mazri", "Mehra", "Mohana", "Nagar", "Nayat", "Nenna", "Pinana", "Punjabi Colony", "Remana", "Rolad", "Sainipura", "Salarpur mazra", "Salimsar mazra", "Silampur trally", "Sonipat Road", "SP Majra", "Surgathal", "Thehad", "Thihaad kalan", "Thihaad khurd", "Vishnu Nagar", "Wazirpur"
  ]
};

const initialProperties = [
  {
    id: 1,
    title: 'Spacious 2BHK House for Rent',
    type: PropertyType.House,
    location: 'Sonipat',
    subLocation: 'Sector 14',
    address: 'House No. 2021, Sector 14, Sonipat, Haryana',
    rent: 15000,
    description: 'A beautiful and spacious 2BHK independent house with a modular kitchen, attached bathrooms, and ample parking space. Located in a prime residential area.',
    images: ['https://picsum.photos/seed/house1/600/400', 'https://picsum.photos/seed/house2/600/400', 'https://picsum.photos/seed/house3/600/400'],
    owner: { name: 'Suresh Verma', phone: '9876543210' },
  },
  {
    id: 2,
    title: 'Main Market Shop on Lease',
    type: PropertyType.Shop,
    location: 'Gohana',
    subLocation: 'Gohana Mandi',
    address: 'Shop No. 5, Main Bazaar, Gohana, Sonipat',
    rent: 25000,
    description: 'Prime location shop available for rent in the heart of Gohana market. High footfall area, suitable for any retail business.',
    images: ['https://picsum.photos/seed/shop1/600/400', 'https://picsum.photos/seed/shop2/600/400', 'https://picsum.photos/seed/shop3/600/400'],
    owner: { name: 'Priya Gupta', phone: '9998887776' },
  },
  {
    id: 3,
    title: 'Industrial Factory Shed in Rai',
    type: PropertyType.Factory,
    location: 'Rai Bahalgarh',
    subLocation: 'Rai',
    address: 'Plot No. 123, Phase 2, Industrial Area, Rai, Sonipat',
    rent: 80000,
    description: 'Large factory shed with 5000 sq. ft. area, 20 ft. height, office space, and power backup. Ideal for manufacturing units.',
    images: ['https://picsum.photos/seed/factory1/600/400', 'https://picsum.photos/seed/factory2/600/400', 'https://picsum.photos/seed/factory3/600/400'],
    owner: { name: 'Amit Singhal', phone: '8816014071' },
  },
    {
    id: 4,
    title: 'Single Room for Students/Bachelors',
    type: PropertyType.Room,
    location: 'Rai Bahalgarh',
    subLocation: 'Murthal',
    address: 'Near DCRUST University Gate No. 2, Murthal',
    rent: 4500,
    description: 'Well-ventilated single room with attached bathroom and kitchen space. Perfect for students and working bachelors. 24/7 water and electricity.',
    images: ['https://picsum.photos/seed/room1/600/400', 'https://picsum.photos/seed/room2/600/400', 'https://picsum.photos/seed/room3/600/400'],
    owner: { name: 'Rajesh Hooda', phone: '7015551234' },
  },
  {
    id: 5,
    title: 'Cozy Room in Gandhi Nagar',
    type: PropertyType.Room,
    location: 'Gannaur',
    subLocation: 'Gandhi Nagar',
    address: '15/3, Gandhi Nagar, Near Main Market, Gannaur',
    rent: 3500,
    description: 'A comfortable and affordable room in a peaceful colony. Suitable for a single person. Close to all amenities.',
    images: ['https://picsum.photos/seed/roomg1/600/400', 'https://picsum.photos/seed/roomg2/600/400', 'https://picsum.photos/seed/roomg3/600/400'],
    owner: { name: 'Sunita Sharma', phone: '8123456789' },
  },
];

// =================================================================================
// ICONS (AS REACT COMPONENTS)
// =================================================================================

const CartIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
  </svg>
);

const FacebookIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
    <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z" />
  </svg>
);

const InstagramIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.85-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z" />
  </svg>
);

const XIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 1200 1227">
        <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6902H306.615L611.412 515.685L658.88 583.579L1055.08 1150.31H892.476L569.165 687.854V687.828Z"/>
    </svg>
);

const WhatsappIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
        <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.956-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.655 4.398 1.905 6.161l-1.217 4.439 4.533-1.187z" />
    </svg>
);

const LocationIcon = ({ className = "h-5 w-5" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 20 20" fill="currentColor">
        <path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
    </svg>
);

const PhoneIcon = ({ className = "h-5 w-5" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 20 20" fill="currentColor">
        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
    </svg>
);

const EmailIcon = ({ className = "h-5 w-5" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 20 20" fill="currentColor">
        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
    </svg>
);

const SparklesIcon = ({ className }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" />
    </svg>
);

const MicrophoneIcon = ({ className }) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}>
        <path d="M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" />
        <path d="M19 10v1a7 7 0 1 1-14 0v-1h2v1a5 5 0 1 0 10 0v-1h2Z" />
    </svg>
);

// =================================================================================
// COMPONENTS
// =================================================================================

const Header = ({ onListPropertyClick, onCartClick, user, onLogin }) => {
    return (
        <header className="bg-white shadow-md sticky top-0 z-50">
            <div className="container mx-auto px-4 py-3 flex justify-between items-center">
                <a href="https://www.sonipathomeservice.com" className="flex items-center space-x-2">
                    <img src="https://www.sonipathomeservice.com/img/logo.png" alt="Sonipat Home Service Logo" className="h-12" />
                    <span className="text-xl font-bold text-gray-800 hidden sm:block">Sonipat Home Service</span>
                </a>
                <div className="flex items-center space-x-4">
                    <button onClick={onListPropertyClick} className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300 font-semibold">
                        List Property
                    </button>
                    <button onClick={onCartClick} className="text-gray-600 hover:text-blue-600">
                        <CartIcon />
                    </button>
                    {user ? (
                        <img src={user.photoUrl} alt={user.name} className="h-10 w-10 rounded-full" />
                    ) : (
                        <button onClick={onLogin} className="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 transition duration-300 font-semibold">
                            Login
                        </button>
                    )}
                </div>
            </div>
        </header>
    );
};

const Footer = () => {
    const playStoreLink = "https://play.google.com/store/apps/details?id=com.crapd.sonipathomeservice";
    const qrCodeImage = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(playStoreLink)}`;

    return (
        <footer className="bg-gray-800 text-white pt-10 pb-6">
            <div className="container mx-auto px-4">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    {/* Company Info */}
                    <div>
                        <h3 className="text-lg font-bold mb-4">Sonipat Home Service.com</h3>
                        <p className="text-gray-400">Your trusted partner for finding rental properties in the Sonipat district.</p>
                        <div className="mt-4 flex items-start space-x-3">
                            <LocationIcon className="h-5 w-5 mt-1 text-blue-400 flex-shrink-0" />
                            <p className="text-gray-400">128/1, Sainipura, Sonipat</p>
                        </div>
                         <div className="mt-2 flex items-center space-x-3">
                            <PhoneIcon className="h-5 w-5 text-blue-400" />
                            <a href="tel:8816014071" className="text-gray-400 hover:text-white">8816014071</a>
                        </div>
                        <div className="mt-2 flex items-center space-x-3">
                            <EmailIcon className="h-5 w-5 text-blue-400" />
                            <a href="mailto:care@sonipathomeservice.com" className="text-gray-400 hover:text-white">care@sonipathomeservice.com</a>
                        </div>
                    </div>

                    {/* Service Locations */}
                    <div>
                        <h3 className="text-lg font-bold mb-4">Service Locations</h3>
                        <ul className="space-y-2">
                            {["Sonipat", "Murthal", "Bahalgarh", "Kundli", "Rai", "Ganaur"].map(loc => (
                                <li key={loc}><a href="#" className="text-gray-400 hover:text-white">{loc}</a></li>
                            ))}
                        </ul>
                    </div>

                    {/* Social & App */}
                    <div>
                        <h3 className="text-lg font-bold mb-4">Follow Us & Get Our App</h3>
                        <div className="flex space-x-4 mb-6">
                            <a href="https://facebook.com/sonipathomeservice" target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-white"><FacebookIcon /></a>
                            <a href="https://instagram.com/sonipathomeservice" target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-white"><InstagramIcon /></a>
                            <a href="https://x.com/sonipathome" target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-white"><XIcon /></a>
                            <a href="https://wa.me/918816014071" target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-white"><WhatsappIcon /></a>
                        </div>
                        <div className="flex items-center space-x-4">
                            <img src={qrCodeImage} alt="Google Play Store QR Code" className="w-24 h-24 bg-white p-1 rounded" />
                            <div>
                                <p className="font-semibold">Download Our App</p>
                                <a href={playStoreLink} target="_blank" rel="noopener noreferrer">
                                    <img src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png" alt="Get it on Google Play" className="h-12 mt-2" />
                                </a>
                            </div>
                        </div>
                    </div>
                     {/* Office Location */}
                    <div>
                        <h3 className="text-lg font-bold mb-4">Our Office</h3>
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3496.002829285816!2d77.01504727522501!3d29.00646117540518!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x390d9b0713555555%3A0x6b13511181206f8c!2sSonipat%20Home%20Service!5e0!3m2!1sen!2sin!4v1716382024100!5m2!1sen!2sin" 
                            width="100%" 
                            height="200" 
                            style={{ border: 0 }} 
                            allowFullScreen="" 
                            loading="lazy"
                            className="rounded-md"
                            referrerPolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                </div>
                <div className="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500">
                    &copy; {new Date().getFullYear()} Sonipat Home Service.com. All Rights Reserved.
                </div>
            </div>
        </footer>
    );
};

const PropertyCard = ({ property, onInquire, user }) => {
    const [currentImageIndex, setCurrentImageIndex] = useState(0);

    const nextImage = (e) => {
        e.stopPropagation();
        setCurrentImageIndex((prevIndex) => (prevIndex + 1) % property.images.length);
    };

    const prevImage = (e) => {
        e.stopPropagation();
        setCurrentImageIndex((prevIndex) => (prevIndex - 1 + property.images.length) % property.images.length);
    };

    const formatOwnerName = (name) => {
        if (!name) return 'N/A';
        const parts = name.split(' ');
        if (parts.length > 1) {
            return `${parts[0]} ${parts[1].charAt(0)}***`;
        }
        return `${name.substring(0, Math.ceil(name.length / 2))}***`;
    };

    const formatPhoneNumber = (phone) => {
        if (!phone || phone.length < 4) return '**********';
        return `******${phone.slice(-4)}`;
    };

    return (
        <div className="bg-white rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">
            <div className="relative">
                <img src={property.images[currentImageIndex]} alt={property.title} className="w-full h-56 object-cover" />
                <div className="absolute inset-0 bg-black bg-opacity-20 flex justify-between items-center px-2">
                    <button onClick={prevImage} className="text-white bg-black bg-opacity-50 rounded-full p-1 hover:bg-opacity-75">
                        &#10094;
                    </button>
                    <button onClick={nextImage} className="text-white bg-black bg-opacity-50 rounded-full p-1 hover:bg-opacity-75">
                        &#10095;
                    </button>
                </div>
                <div className="absolute top-2 left-2 bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-semibold">{property.type}</div>
            </div>
            <div className="p-4">
                <h3 className="text-xl font-bold text-gray-800 mb-2">{property.title}</h3>
                <p className="text-gray-600 flex items-center mb-2">
                    <LocationIcon className="h-5 w-5 mr-2 text-gray-500" />
                    {property.subLocation}, {property.location}
                </p>
                <p className="text-2xl font-bold text-blue-600 mb-4">
                    ₹{property.rent.toLocaleString('en-IN')} <span className="text-base font-normal text-gray-500">/ month</span>
                </p>
                <div className="border-t pt-4">
                    <div className="text-sm text-gray-700">
                        <p className="mb-2"><strong>Owner:</strong> {user ? property.owner.name : formatOwnerName(property.owner.name)}</p>
                        <p><strong>Contact:</strong> {user ? property.owner.phone : formatPhoneNumber(property.owner.phone)}</p>
                    </div>
                    <button
                        onClick={() => onInquire(property)}
                        className="w-full mt-4 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition duration-300 font-semibold"
                    >
                        {user ? 'Contact Owner' : 'Login to View Details'}
                    </button>
                </div>
            </div>
        </div>
    );
};

const PropertyList = ({ properties, onInquire, user }) => {
    const [filters, setFilters] = useState({
        location: 'All',
        subLocation: 'All',
        type: 'All',
        minRent: '',
        maxRent: '',
    });
    
    const [subLocations, setSubLocations] = useState([]);

    useEffect(() => {
        if (filters.location === 'All') {
            setSubLocations([]);
        } else {
            setSubLocations(sonipatLocations[filters.location] || []);
        }
        setFilters(f => ({ ...f, subLocation: 'All' }));
    }, [filters.location]);
    
    const handleFilterChange = (e) => {
        const { name, value } = e.target;
        setFilters({
            ...filters,
            [name]: value,
        });
    };

    const filteredProperties = useMemo(() => {
        return properties.filter(p => {
            const { location, subLocation, type, minRent, maxRent } = filters;
            return (
                (location === 'All' || p.location === location) &&
                (subLocation === 'All' || p.subLocation === subLocation) &&
                (type === 'All' || p.type === type) &&
                (minRent === '' || p.rent >= parseInt(minRent)) &&
                (maxRent === '' || p.rent <= parseInt(maxRent))
            );
        });
    }, [properties, filters]);

    return (
        <div className="container mx-auto px-4 py-8">
             {/* Filters */}
            <div className="bg-white p-4 rounded-lg shadow-md mb-8 sticky top-[88px] z-40">
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end">
                    {/* Location Filter */}
                    <div>
                        <label htmlFor="location" className="block text-sm font-medium text-gray-700">Location (Block)</label>
                        <select id="location" name="location" value={filters.location} onChange={handleFilterChange} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                            <option>All</option>
                            {Object.keys(sonipatLocations).map(loc => <option key={loc}>{loc}</option>)}
                        </select>
                    </div>

                     {/* Sub-Location Filter */}
                    <div>
                        <label htmlFor="subLocation" className="block text-sm font-medium text-gray-700">Area/Colony</label>
                        <select id="subLocation" name="subLocation" value={filters.subLocation} onChange={handleFilterChange} disabled={!subLocations.length} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md disabled:bg-gray-200">
                            <option>All</option>
                            {subLocations.map(sub => <option key={sub}>{sub}</option>)}
                        </select>
                    </div>

                    {/* Type Filter */}
                    <div>
                        <label htmlFor="type" className="block text-sm font-medium text-gray-700">Property Type</label>
                        <select id="type" name="type" value={filters.type} onChange={handleFilterChange} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                            <option>All</option>
                            {Object.values(PropertyType).map(type => <option key={type}>{type}</option>)}
                        </select>
                    </div>

                    {/* Rent Range Filter */}
                    <div className="lg:col-span-2 grid grid-cols-2 gap-4">
                         <div>
                            <label htmlFor="minRent" className="block text-sm font-medium text-gray-700">Min Rent</label>
                            <input type="number" name="minRent" id="minRent" value={filters.minRent} onChange={handleFilterChange} placeholder="e.g., 5000" className="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"/>
                        </div>
                        <div>
                            <label htmlFor="maxRent" className="block text-sm font-medium text-gray-700">Max Rent</label>
                            <input type="number" name="maxRent" id="maxRent" value={filters.maxRent} onChange={handleFilterChange} placeholder="e.g., 20000" className="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"/>
                        </div>
                    </div>
                </div>
            </div>
            
            {/* Property Grid */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                {filteredProperties.length > 0 ? (
                    filteredProperties.map(property => (
                        <PropertyCard key={property.id} property={property} onInquire={onInquire} user={user} />
                    ))
                ) : (
                    <div className="col-span-full text-center py-12 text-gray-500">
                        <h3 className="text-2xl font-semibold">No Properties Found</h3>
                        <p>Try adjusting your filters or check back later.</p>
                    </div>
                )}
            </div>
        </div>
    );
};

const Modal = ({ isOpen, onClose, title, children }) => {
    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-[100] flex justify-center items-center" onClick={onClose}>
            <div className="bg-white rounded-lg shadow-xl w-full max-w-md p-6 relative" onClick={e => e.stopPropagation()}>
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h2 className="text-2xl font-bold mb-4">{title}</h2>
                {children}
            </div>
        </div>
    );
};

const PropertyFormModal = ({ isOpen, onClose, onAddProperty }) => {
    const [formData, setFormData] = useState({
        title: '',
        type: PropertyType.Room,
        location: Object.keys(sonipatLocations)[0],
        subLocation: sonipatLocations[Object.keys(sonipatLocations)[0]][0],
        rent: '',
        description: '',
        ownerName: '',
        ownerPhone: '',
    });
    const [images, setImages] = useState([]);
    const [imagePreviews, setImagePreviews] = useState([]);

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
        if (name === 'location') {
             setFormData(prev => ({ ...prev, subLocation: sonipatLocations[value][0] }));
        }
    };
    
    const handleImageChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const files = Array.from(e.target.files).slice(0, 3);
            setImages(files);
            const previews = files.map(file => URL.createObjectURL(file));
            setImagePreviews(previews);
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        // Here you would handle image uploads and form submission
        // For now, we'll just simulate it
        const newProperty = {
            id: Date.now(),
            title: formData.title,
            type: formData.type,
            location: formData.location,
            subLocation: formData.subLocation,
            rent: parseInt(formData.rent),
            description: formData.description,
            images: imagePreviews.length > 0 ? imagePreviews : ['https://picsum.photos/seed/newprop/600/400'], // Placeholder
            owner: {
                name: formData.ownerName,
                phone: formData.ownerPhone
            }
        };
        
        // This is where you would integrate with Google Apps Script
        console.log("Submitting to Google Sheet:", newProperty);

        onAddProperty(newProperty);
        onClose();
    };

    return (
        <Modal isOpen={isOpen} onClose={onClose} title="List Your Property">
            <form onSubmit={handleSubmit} className="space-y-4">
                {/* Image Upload */}
                 <div>
                    <label className="block text-sm font-medium text-gray-700">Property Images (up to 3)</label>
                    <div className="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div className="space-y-1 text-center">
                            <svg className="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                            </svg>
                            <div className="flex text-sm text-gray-600">
                                <label htmlFor="file-upload" className="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                    <span>Upload files</span>
                                    <input id="file-upload" name="file-upload" type="file" className="sr-only" multiple accept="image/*" onChange={handleImageChange} />
                                </label>
                                <p className="pl-1">or drag and drop</p>
                            </div>
                            <p className="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                        </div>
                    </div>
                     <div className="mt-2 flex space-x-2">
                        {imagePreviews.map((src, index) => <img key={index} src={src} className="h-16 w-16 rounded object-cover" />)}
                    </div>
                </div>

                <input type="text" name="title" placeholder="Property Title" value={formData.title} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <textarea name="description" placeholder="Description" value={formData.description} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                
                <div className="grid grid-cols-2 gap-4">
                    <select name="type" value={formData.type} onChange={handleInputChange} className="w-full p-2 border rounded">
                        {Object.values(PropertyType).map(t => <option key={t} value={t}>{t}</option>)}
                    </select>
                    <input type="number" name="rent" placeholder="Monthly Rent (₹)" value={formData.rent} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                </div>
                
                 <div className="grid grid-cols-2 gap-4">
                    <select name="location" value={formData.location} onChange={handleInputChange} className="w-full p-2 border rounded">
                         {Object.keys(sonipatLocations).map(loc => <option key={loc} value={loc}>{loc}</option>)}
                    </select>
                     <select name="subLocation" value={formData.subLocation} onChange={handleInputChange} className="w-full p-2 border rounded">
                         {sonipatLocations[formData.location].map(sub => <option key={sub} value={sub}>{sub}</option>)}
                    </select>
                </div>

                <input type="text" name="ownerName" placeholder="Your Name" value={formData.ownerName} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <input type="tel" name="ownerPhone" placeholder="Your Phone Number" pattern="[0-9]{10}" value={formData.ownerPhone} onChange={handleInputChange} className="w-full p-2 border rounded" required />

                <button type="submit" className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 font-semibold">Add Property</button>
            </form>
        </Modal>
    );
};

const InquiryModal = ({ isOpen, onClose, property }) => {
    const [formData, setFormData] = useState({
        name: '',
        phone: '',
        email: '',
        address: '',
        landmark: '',
        pincode: '',
    });

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({...prev, [name]: value}));
    };

    const handlePayment = () => {
        const options = {
            key: "YOUR_RAZORPAY_LIVE_KEY_ID", // Replace with your live key
            amount: "50000", // Amount in paise (e.g., 500.00)
            currency: "INR",
            name: "Sonipat Home Service",
            description: `Booking for ${property.title}`,
            handler: function (response){
                alert("Payment successful: " + response.razorpay_payment_id);
                // Here you would send form data and payment ID to your backend/Google Sheet
                console.log({ ...formData, paymentId: response.razorpay_payment_id });
                onClose();
            },
            prefill: {
                name: formData.name,
                email: formData.email,
                contact: formData.phone
            },
            theme: {
                color: "#3399cc"
            }
        };
        const rzp1 = new Razorpay(options);
        rzp1.on('payment.failed', function (response){
             alert("Payment failed: " + response.error.description);
        });
        rzp1.open();
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        handlePayment();
    };

    return (
        <Modal isOpen={isOpen} onClose={onClose} title={`Inquire about ${property?.title || ''}`}>
             <form onSubmit={handleSubmit} className="space-y-4">
                <input type="text" name="name" placeholder="Full Name" value={formData.name} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <input type="tel" name="phone" placeholder="Mobile Number" pattern="[0-9]{10}" value={formData.phone} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <input type="email" name="email" placeholder="Email ID" value={formData.email} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <input type="text" name="address" placeholder="Full Address" value={formData.address} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <input type="text" name="landmark" placeholder="Landmark" value={formData.landmark} onChange={handleInputChange} className="w-full p-2 border rounded" />
                <input type="text" name="pincode" placeholder="Pin Code" pattern="[0-9]{6}" value={formData.pincode} onChange={handleInputChange} className="w-full p-2 border rounded" required />
                <button type="submit" className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 font-semibold">Proceed to Payment</button>
            </form>
        </Modal>
    );
};

const AIStudioModal = ({ isOpen, onClose, onKeySelected }) => {
    return (
        <Modal isOpen={isOpen} onClose={onClose} title="Select API Key">
            <div className="space-y-4 text-center">
                <p className="text-gray-600">
                    To use the AI-powered Live Assistant, please select your Google AI API key.
                </p>
                <p className="text-sm text-gray-500">
                    Generative AI API calls are billed separately. For more information, please see the{" "}
                    <a
                        href="https://ai.google.dev/gemini-api/docs/billing"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-blue-600 hover:underline"
                    >
                        billing documentation
                    </a>
                    .
                </p>
                <button
                    onClick={async () => {
                        await window.aistudio.openSelectKey();
                        onKeySelected();
                        onClose();
                    }}
                    className="w-full bg-blue-600 text-white p-3 rounded-md hover:bg-blue-700 font-semibold"
                >
                    Select Your API Key
                </button>
            </div>
        </Modal>
    );
};

const LiveAssistant = ({ onAsk }) => {
    const [isListening, setIsListening] = useState(false);
    const [status, setStatus] = useState("Click the mic to start");
    const sessionPromiseRef = useRef(null);

    const startConversation = async () => {
        setStatus("Connecting to AI...");
        setIsListening(true);
        
        // Safely access API key to prevent browser errors
        const apiKey = (typeof window.process !== 'undefined' && window.process.env) ? window.process.env.API_KEY : null;
        if (!apiKey) {
            setStatus("AI features are not available in this environment.");
            setIsListening(false);
            return;
        }
        const ai = new GoogleGenAI({ apiKey: apiKey });

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const inputAudioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 16000 });
            
            sessionPromiseRef.current = ai.live.connect({
                model: 'gemini-2.5-flash-native-audio-preview-09-2025',
                callbacks: {
                    onopen: () => {
                        setStatus("Listening... Ask me anything!");
                        const source = inputAudioContext.createMediaStreamSource(stream);
                        const scriptProcessor = inputAudioContext.createScriptProcessor(4096, 1, 1);
                        
                        scriptProcessor.onaudioprocess = (audioProcessingEvent) => {
                            const inputData = audioProcessingEvent.inputBuffer.getChannelData(0);
                             const pcmBlob = {
                                data: encode(new Uint8Array(new Int16Array(inputData.map(x => x * 32768)).buffer)),
                                mimeType: 'audio/pcm;rate=16000',
                            };
                            sessionPromiseRef.current.then((session) => {
                                session.sendRealtimeInput({ media: pcmBlob });
                            });
                        };
                        source.connect(scriptProcessor);
                        scriptProcessor.connect(inputAudioContext.destination);
                    },
                    onmessage: (message) => {
                        if (message.serverContent?.inputTranscription) {
                            const text = message.serverContent.inputTranscription.text;
                             if(text) onAsk(text); // Pass transcription up
                        }
                        if (message.serverContent?.turnComplete) {
                           // Stop listening after turn is complete
                           stopConversation();
                        }
                    },
                    onerror: (e) => {
                        console.error('Live session error:', e);
                        setStatus("Error occurred. Please try again.");
                        setIsListening(false);
                    },
                    onclose: () => {
                        console.log('Live session closed');
                        setStatus("Click the mic to start");
                        inputAudioContext.close();
                        stream.getTracks().forEach(track => track.stop());
                    },
                },
                 config: {
                    responseModalities: [Modality.AUDIO],
                    inputAudioTranscription: {},
                },
            });
        } catch(e) {
             console.error("Error starting conversation:", e);
             setStatus("Could not access microphone.");
             setIsListening(false);
        }
    };
    
    // Helper function for encoding raw audio
    const encode = (bytes) => {
        let binary = '';
        const len = bytes.byteLength;
        for (let i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        return btoa(binary);
    }

    const stopConversation = () => {
        if (sessionPromiseRef.current) {
            sessionPromiseRef.current.then(session => session.close());
            sessionPromiseRef.current = null;
        }
        setIsListening(false);
    };
    
    const toggleListening = () => {
        if (isListening) {
            stopConversation();
        } else {
            onAsk(''); // Clear previous query
            startConversation();
        }
    };

    return (
        <div className="fixed bottom-6 right-6 z-50 flex flex-col items-center">
             <button
                onClick={toggleListening}
                className={`rounded-full p-4 shadow-lg transition-colors duration-300 flex items-center justify-center ${
                    isListening ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'
                }`}
                aria-label={isListening ? 'Stop listening' : 'Start listening'}
            >
                <MicrophoneIcon className="h-8 w-8 text-white" />
            </button>
            <p className="mt-2 text-sm text-white bg-gray-900 bg-opacity-70 px-3 py-1 rounded-full">{status}</p>
        </div>
    );
};


// =================================================================================
// MAIN APP COMPONENT
// =================================================================================

const App = () => {
    const [bgColor, setBgColor] = useState('bg-gray-50');
    const [properties, setProperties] = useState(initialProperties);
    const [user, setUser] = useState(null);
    const [isPropertyFormOpen, setIsPropertyFormOpen] = useState(false);
    const [isCartModalOpen, setIsCartModalOpen] = useState(false);
    const [selectedPropertyForInquiry, setSelectedPropertyForInquiry] = useState(null);
    const [isAIStudioModalOpen, setIsAIStudioModalOpen] = useState(false);
    const [isAIStudioEnv, setIsAIStudioEnv] = useState(false);
    const [hasApiKey, setHasApiKey] = useState(false);
    const [aiResponse, setAiResponse] = useState("");
    
    const colors = [
        'bg-gray-50', 'bg-blue-50', 'bg-green-50', 'bg-yellow-50', 'bg-purple-50', 'bg-pink-50'
    ];
    
    useEffect(() => {
        const interval = setInterval(() => {
            const randomIndex = Math.floor(Math.random() * colors.length);
            setBgColor(colors[randomIndex]);
        }, 60000); // Change every minute

        const checkEnv = async () => {
            // Check for the specific AI Studio environment safely.
            // In a standard browser (like on GitHub pages), 'window.aistudio' and 'window.process' will be undefined.
            if (typeof window.aistudio !== 'undefined' && typeof window.process !== 'undefined' && window.process.env) {
                setIsAIStudioEnv(true);
                const hasKey = await window.aistudio.hasSelectedApiKey();
                setHasApiKey(hasKey);
                if (!hasKey) {
                    setIsAIStudioModalOpen(true);
                }
            } else {
                // Not in AI Studio, so disable AI features to prevent errors.
                setIsAIStudioEnv(false);
                setHasApiKey(false);
                console.log("AI features disabled. App is not running in the required AI Studio environment.");
            }
        };

        checkEnv();
        
        return () => clearInterval(interval);
    }, []);

    const handleLogin = () => {
        // This is a mock login. In a real app, you'd use Google OAuth.
        setUser({
            name: 'Demo User',
            email: 'demo@example.com',
            photoUrl: 'https://i.pravatar.cc/150?u=demo'
        });
    };

    const handleAddProperty = (newProperty) => {
        setProperties(prev => [newProperty, ...prev]);
    };
    
    const handleInquire = (property) => {
        if (user) {
            setSelectedPropertyForInquiry(property);
        } else {
            handleLogin(); // Prompt login if not logged in
        }
    };

    const handleAIAssistantAsk = async (query) => {
        if (!query) {
            setAiResponse("");
            return;
        }
        if (!isAIStudioEnv) {
            setAiResponse("AI features are not available in this environment.");
            return;
        }
        if (!hasApiKey) {
            setIsAIStudioModalOpen(true);
            return;
        }
        
        setAiResponse("AI is thinking...");
        try {
            // Safely access API key to prevent browser errors
            const apiKey = (typeof window.process !== 'undefined' && window.process.env) ? window.process.env.API_KEY : null;
            if (!apiKey) {
                throw new Error("API Key not available in this environment.");
            }
            const ai = new GoogleGenAI({ apiKey: apiKey });
            const propertyContext = properties.map(p => `${p.title} in ${p.subLocation} for rent ₹${p.rent}`).join('. ');
            const fullPrompt = `Based on the following available properties: ${propertyContext}. The user is asking: "${query}". Answer the user's question about the properties.`;
            
            const response = await ai.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: fullPrompt
            });

            setAiResponse(response.text);
        } catch(e) {
            console.error("Gemini API error:", e);
            setAiResponse("Sorry, I couldn't process that request.");
            if (e.message.includes("Requested entity was not found.")) {
                setHasApiKey(false);
                setIsAIStudioModalOpen(true);
            }
        }
    };

    return (
        <div className={`flex flex-col min-h-screen transition-colors duration-1000 ${bgColor}`}>
            <Header 
                onListPropertyClick={() => user ? setIsPropertyFormOpen(true) : handleLogin()}
                onCartClick={() => setIsCartModalOpen(true)}
                user={user}
                onLogin={handleLogin}
            />
            
            <main className="flex-grow">
                 {aiResponse && (
                    <div className="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 container mx-auto my-4 rounded-md shadow-md" role="alert">
                        <p className="font-bold flex items-center">
                           <SparklesIcon className="h-5 w-5 mr-2" /> AI Assistant says:
                        </p>
                        <p>{aiResponse}</p>
                    </div>
                )}
                <PropertyList properties={properties} onInquire={handleInquire} user={user} />
            </main>
            
            <Footer />

            <PropertyFormModal 
                isOpen={isPropertyFormOpen}
                onClose={() => setIsPropertyFormOpen(false)}
                onAddProperty={handleAddProperty}
            />
            
            <InquiryModal
                isOpen={!!selectedPropertyForInquiry}
                onClose={() => setSelectedPropertyForInquiry(null)}
                property={selectedPropertyForInquiry}
            />
            
             <Modal
                isOpen={isCartModalOpen}
                onClose={() => setIsCartModalOpen(false)}
                title="My Cart"
            >
                <p>Your cart is currently empty. Add properties to inquire about them.</p>
            </Modal>
            
            {isAIStudioEnv && <AIStudioModal 
                isOpen={isAIStudioModalOpen}
                onClose={() => setIsAIStudioModalOpen(false)}
                onKeySelected={() => setHasApiKey(true)}
            />}

            {isAIStudioEnv && hasApiKey && <LiveAssistant onAsk={handleAIAssistantAsk} />}
        </div>
    );
};

// =================================================================================
// RENDER THE APP
// =================================================================================

const container = document.getElementById('root');
const root = createRoot(container);
root.render(<App />);
    </script>
  </body>
</html>
